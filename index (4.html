index

<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>FPS Test</title>
<style>
body { margin: 0; overflow: hidden; }
#start {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  padding: 20px 40px;
  background: black;
  color: white;
  font-size: 20px;
  cursor: pointer;
}
</style>
</head>
<body>

<div id="start">クリックして開始</div>

<script type="module">
import * as THREE from 'https://unpkg.com/three@0.158.0/build/three.module.js';
import { PointerLockControls } from 'https://unpkg.com/three@0.158.0/examples/jsm/controls/PointerLockControls.js';

let camera, scene, renderer, controls;
let moveForward = false, moveBackward = false;
let moveLeft = false, moveRight = false;
let velocity = new THREE.Vector3();

init();
animate();

function init() {
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x202020);

  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 1, 1000);

  renderer = new THREE.WebGLRenderer();
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  controls = new PointerLockControls(camera, document.body);

  const startButton = document.getElementById('start');
  startButton.addEventListener('click', () => {
    controls.lock();
  });

  controls.addEventListener('lock', () => {
    startButton.style.display = 'none';
  });

  controls.addEventListener('unlock', () => {
    startButton.style.display = 'block';
  });

  scene.add(controls.getObject());

  const light = new THREE.HemisphereLight(0xffffff, 0x444444);
  scene.add(light);

  const floor = new THREE.Mesh(
    new THREE.PlaneGeometry(200, 200),
    new THREE.MeshStandardMaterial({color: 0x808080})
  );
  floor.rotation.x = -Math.PI / 2;
  scene.add(floor);

  for (let i = 0; i < 20; i++) {
    const box = new THREE.Mesh(
      new THREE.BoxGeometry(5, 5, 5),
      new THREE.MeshStandardMaterial({color: 0xff0000})
    );
    box.position.set(
      Math.random() * 100 - 50,
      2.5,
      Math.random() * 100 - 50
    );
    scene.add(box);
  }

  document.addEventListener('keydown', (event) => {
    switch (event.code) {
      case 'KeyW': moveForward = true; break;
      case 'KeyS': moveBackward = true; break;
      case 'KeyA': moveLeft = true; break;
      case 'KeyD': moveRight = true; break;
    }
  });

  document.addEventListener('keyup', (event) => {
    switch (event.code) {
      case 'KeyW': moveForward = false; break;
      case 'KeyS': moveBackward = false; break;
      case 'KeyA': moveLeft = false; break;
      case 'KeyD': moveRight = false; break;
    }
  });
}

function animate() {
  requestAnimationFrame(animate);

  velocity.x -= velocity.x * 0.1;
  velocity.z -= velocity.z * 0.1;

  const speed = 0.2;

  if (moveForward) velocity.z -= speed;
  if (moveBackward) velocity.z += speed;
  if (moveLeft) velocity.x -= speed;
  if (moveRight) velocity.x += speed;

  controls.moveRight(-velocity.x);
  controls.moveForward(-velocity.z);

  renderer.render(scene, camera);
}
</script>

</body>
</html>
